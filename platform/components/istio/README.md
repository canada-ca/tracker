# Istio

This folder contains the config for Istio. It was generated by the following command:

```
istioctl manifest generate --set meshConfig.accessLogFile=/dev/stdout --set meshConfig.accessLogEncoding=JSON --set values.pilot.traceSampling=100.00 > platform/components/istio/istio.yaml
```

Istio's config leaves extra ports open, and our config removes this ports by applying strategic merge patch. You can (and should) test that the patch removes all ports but 80 and 443 after upgrading.

You can verify this with the following command:

```
[mike@ouroboros tracker]$ kustomize build platform/gke | yq -y '. | select(.kind == "Service" and .metadata.name == "istio-ingressgateway").spec.ports'
- name: http2
  port: 80
  protocol: TCP
  targetPort: 8080
- name: https
  port: 443
  protocol: TCP
  targetPort: 8443
```
